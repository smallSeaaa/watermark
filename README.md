# 图片日期水印工具

一个支持命令行和图形界面的应用程序，用于自动为图片添加基于拍摄日期或自定义文本的水印，并提供丰富的水印布局与样式功能。

## 功能特点

### 核心功能
- 从图片的 EXIF 信息中提取拍摄日期
- 如无 EXIF 信息，使用文件修改时间作为备选
- 支持自定义文本作为水印内容
- 自动创建输出目录并保存带水印的图片
- 支持处理单个图片文件或整个目录下的所有图片
- 支持多种图片格式（JPG、PNG、BMP、GIF、TIFF）
- 保留透明PNG背景处理

### GUI 特性
- **实时预览**：所有调整可在主预览窗口中即时显示，支持图片列表切换
- **位置控制**：
  - 预设九宫格布局（四角 + 中心），一键快速放置水印
  - 支持鼠标拖拽在预览图上自由移动水印
- 丰富的样式设置：
  - 系统字体选择，支持粗体和斜体
  - 文本颜色设置（预定义颜色或调色板精确选择）
  - 字体大小调整
  - 水印透明度调节
  - 阴影效果（可启用/禁用，调整颜色和偏移）
  - 描边效果（可启用/禁用，调整颜色和宽度）
- 拖放功能支持，可直接拖拽图片到窗口
- 批量处理和进度显示
- 图片尺寸调整功能

## 安装说明

1. 确保已安装 Python 3.6 或更高版本

2. 安装所需依赖：

```bash
pip install -r requirements.txt
```

## 使用方法

### 图形界面版本

启动GUI版本：

```bash
python watermark_gui.py
```

**使用步骤：**
1. 通过拖放或点击"添加图片"按钮导入图片
2. 在左侧面板设置水印参数（文本、字体、颜色、大小等）
3. 使用九宫格按钮或鼠标拖拽设置水印位置
4. 实时预览窗口查看效果
5. 点击"处理图片"按钮开始批量处理

**主界面布局：**
- **左侧面板**：包含所有水印参数设置
- **中间预览区**：实时显示水印效果，支持图片切换
- **右侧图片列表**：已添加的图片列表，可点击切换显示
- **底部状态栏**：显示处理进度和结果统计

### 命令行版本

处理单个图片文件：

```bash
python watermark.py 图片文件路径
```

处理整个目录下的所有图片：

```bash
python watermark.py 目录路径
```

### 高级选项（命令行）

程序提供了多个可选参数来自定义水印效果：

```bash
python watermark.py 图片路径 --font-size 字体大小 --text-color 文本颜色 --position 位置
```

#### 可用选项：

- `--font-size`：设置水印字体大小（默认值：30）
- `--text-color`：设置水印文本颜色（支持多种格式，默认值：black）
- `--position`：设置水印位置（可选值：top-left、top-right、bottom-left、bottom-right、center、top、bottom、left、right，默认值：bottom-right）

#### 颜色格式：

颜色参数支持以下几种格式：

1. 预定义颜色名称：`black`、`white`、`red`、`green`、`blue`、`yellow`、`cyan`、`magenta`
2. 十六进制格式：`#RRGGBB` 或 `#RRGGBBAA`（例如：`#FF0000` 表示红色）
3. RGB/RGBA 元组格式：`(r,g,b)` 或 `(r,g,b,a)`（例如：`(255,0,0)` 表示红色）

## 输出说明

- 程序会在原图片所在目录下创建一个名为`原目录名_watermark`的子目录
- 处理后的图片将保存在该目录中，文件名格式为`watermarked_原文件名`
- 处理过程中输出详细的日志信息，包括成功和失败记录

## 示例

### GUI版本示例

1. 拖放图片到主窗口
2. 在左侧面板选择预设位置或拖拽水印到自定义位置
3. 调整样式参数直到满意
4. 点击"处理图片"按钮

### 命令行版本示例

1. 使用 40 号字体大小：
   ```bash
   python watermark.py picture\1.jpg --font-size 40
   ```

2. 使用红色文本：
   ```bash
   python watermark.py picture\1.jpg --text-color red
   ```

3. 将水印放在图片中心：
   ```bash
   python watermark.py picture\1.jpg --position center
   ```

4. 组合多个选项：
   ```bash
   python watermark.py picture --font-size 25 --text-color blue --position top-left
   ```

5. 处理整个目录：
   ```bash
   python watermark.py picture
   ```
   这将在 `picture` 目录下创建 `picture_watermark` 子目录，并将所有处理后的图片保存在其中。

## 版本历史

### 最新版本

- 添加实时预览功能，所有调整即时可见
- 增强位置控制，支持预设九宫格布局和鼠标拖拽自定义位置
- 优化水印渲染和图片处理逻辑
- 修复水印位置无法保存的问题

### 版本 2.1

- 添加系统字体选择功能
- 集成颜色调色板对话框，支持精确颜色选择
- 增加水印样式效果（阴影和描边）
- 增强透明PNG支持和处理
- 优化水印文本渲染逻辑

### 版本 2.0

- 添加图形用户界面（GUI）版本
- 实现拖放功能支持，用户可直接拖拽图片到窗口
- 支持单张或批量导入图片
- 图形化设置水印参数
- 支持自定义输出文件夹和命名规则
- 显示处理进度和结果统计

### 版本 1.0

- 完成基本功能实现
- 支持从 EXIF 信息提取拍摄日期
- 支持自定义字体大小、颜色和位置
- 支持批量处理图片目录
- 支持 8 种水印位置选项
- 提供详细的使用文档
